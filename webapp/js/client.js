/**
 Copyright(c) 2016 SocialVid.in. All rights reserved.
 **/
"use strict";function trace(e){if("\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance){var t=(window.performance.now()/1e3).toFixed(3);webrtcUtils.log(t+": "+e)}else webrtcUtils.log(e)}function requestUserMedia(e){return new Promise(function(t,i){getUserMedia(e,t,i)})}var getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null,webrtcUtils={log:function(){"undefined"!=typeof module||"function"==typeof require&&"function"==typeof define||console.log.apply(console,arguments)},extractVersion:function(e,t,i){var n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}};if("object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?this.mozSrcObject=e:(this._srcObject=e,this.src=URL.createObjectURL(e))}}),getUserMedia=window.navigator&&window.navigator.getUserMedia),attachMediaStream=function(e,t){e.srcObject=t},reattachMediaStream=function(e,t){e.srcObject=t.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){if(webrtcUtils.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=webrtcUtils.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),webrtcMinimumVersion=31,window.RTCPeerConnection=function(e,t){if(38>webrtcDetectedVersion&&e&&e.iceServers){for(var i=[],n=0;n<e.iceServers.length;n++){var a=e.iceServers[n];if(a.hasOwnProperty("urls"))for(var o=0;o<a.urls.length;o++){var r={url:a.urls[o]};0===a.urls[o].indexOf("turn")&&(r.username=a.username,r.credential=a.credential),i.push(r)}else i.push(e.iceServers[n])}e.iceServers=i}return new mozRTCPeerConnection(e,t)},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),getUserMedia=function(e,t,i){var n=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=e[i]="object"==typeof e[i]?e[i]:{ideal:e[i]};if((void 0!==n.min||void 0!==n.max||void 0!==n.exact)&&t.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[i]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var a={};"number"==typeof n.ideal?a[i]={min:n.ideal,max:n.ideal}:a[i]=n.ideal,e.advanced.push(a),delete n.ideal,Object.keys(n).length||delete e[i]}}}),t.length&&(e.require=t),e};return 38>webrtcDetectedVersion&&(webrtcUtils.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=n(e.audio)),e.video&&(e.video=n(e.video)),webrtcUtils.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,i)},navigator.getUserMedia=getUserMedia,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:requestUserMedia,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},41>webrtcDetectedVersion){var orgEnumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return orgEnumerateDevices().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){webrtcUtils.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=webrtcUtils.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),webrtcMinimumVersion=38,window.RTCPeerConnection=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var i=new webkitRTCPeerConnection(e,t),n=i.getStats.bind(i);return i.getStats=function(e,t,i){var a=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return n(e,t);var r=function(e){var t={},i=e.result();return i.forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),t[i.id]=i}),t};if(arguments.length>=2){var s=function(e){o[1](r(e))};return n.apply(this,[s,arguments[0]])}return new Promise(function(t,i){1===o.length&&null===e?n.apply(a,[function(e){t.apply(null,[r(e)])},i]):n.apply(a,[t,i])})},i},["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,a){t.apply(e,[n,a,i])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,i=this;return new Promise(function(n,a){t.apply(i,[e[0],function(){n(),e.length>=2&&e[1].apply(null,[])},function(t){a(t),e.length>=3&&e[2].apply(null,[t])}])})}});var constraintsToChrome=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[a("min",i)]=n.ideal,t.optional.push(o),o={},o[a("max",i)]=n.ideal,t.optional.push(o)):(o[a("",i)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",i)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,i)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(getUserMedia=function(e,t,i){return e.audio&&(e.audio=constraintsToChrome(e.audio)),e.video&&(e.video=constraintsToChrome(e.video)),webrtcUtils.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,i)},navigator.getUserMedia=getUserMedia,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){e(i.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return webrtcUtils.log("spec:   "+JSON.stringify(e)),e.audio=constraintsToChrome(e.audio),e.video=constraintsToChrome(e.video),webrtcUtils.log("chrome: "+JSON.stringify(e)),origGetUserMedia(e)}}else navigator.mediaDevices.getUserMedia=function(e){return requestUserMedia(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){webrtcUtils.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){webrtcUtils.log("Dummy mediaDevices.removeEventListener called.")}),attachMediaStream=function(e,t){webrtcDetectedVersion>=43?e.srcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):webrtcUtils.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(webrtcUtils.log("This appears to be Edge"),webrtcDetectedBrowser="edge",webrtcDetectedVersion=webrtcUtils.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),webrtcMinimumVersion=12):webrtcUtils.log("Browser does not appear to be WebRTC-capable");else webrtcUtils.log("This does not appear to be a browser"),webrtcDetectedBrowser="not a browser";var webrtcTesting={};try{Object.defineProperty(webrtcTesting,"version",{set:function(e){webrtcDetectedVersion=e}})}catch(e){}if("undefined"!=typeof module){var RTCPeerConnection,RTCIceCandidate,RTCSessionDescription;"undefined"!=typeof window&&(RTCPeerConnection=window.RTCPeerConnection,RTCIceCandidate=window.RTCIceCandidate,RTCSessionDescription=window.RTCSessionDescription),module.exports={RTCPeerConnection:RTCPeerConnection,RTCIceCandidate:RTCIceCandidate,RTCSessionDescription:RTCSessionDescription,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion,webrtcTesting:webrtcTesting,webrtcUtils:webrtcUtils}}else"function"==typeof require&&"function"==typeof define&&define([],function(){return{RTCPeerConnection:window.RTCPeerConnection,RTCIceCandidate:window.RTCIceCandidate,RTCSessionDescription:window.RTCSessionDescription,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion,webrtcTesting:webrtcTesting,webrtcUtils:webrtcUtils}});!function(e){function t(e){var t={x:0,y:0};return e.hasOwnProperty("layerX")?(t.x=e.layerX,t.y=e.layerY):(t.x=e.offsetX,t.y=e.offsetY),t}function i(e,t,i){this.a=!1,this.b=e,this.e=t,this.f=i,this.g=[]}function n(e,t,i){this.a=!1,this.b=e,this.g=[],this.o=10}function a(e,t,i){this.a=!1,this.b=e,this.e=t,this.f=i,this.g=[]}function o(e,t,i){this.a=!1,this.b=e,this.e=t,this.f=i,this.g=[]}function r(e,t,i){this.a=!1,this.b=e,this.g=[]}function s(e){this.s=document.createElement("canvas"),this.t=this.s.getContext("2d"),this.u=e}i.prototype.h=function(e){this.a=!0,this.g.length=0,this.g.push(e)},i.prototype.j=function(e){this.a&&(this.e.clearRect(0,0,this.f.width,this.f.height),this.e.beginPath(),this.e.moveTo(this.g[0].x,this.g[0].y),this.e.lineTo(e.x,e.y),this.e.stroke())},i.prototype.k=function(e){return this.a?(this.j(e),this.a=!1,this.b.drawImage(this.f,0,0),this.e.clearRect(0,0,this.f.width,this.f.height),this.g.push(e),!0):!1},i.prototype.m=function(){return this.g},i.prototype.n=function(e){this.b.beginPath(),this.b.moveTo(e[0].x,e[0].y),this.b.lineTo(e[1].x,e[1].y),this.b.stroke()},n.prototype.p=function(){this.b.globalCompositeOperation="destination-out",this.b.fillStyle="rgba(0, 0, 0, 1.0)"},n.prototype.h=function(e){this.a=!0,this.g.length=0,this.g.push(e),this.b.save(),this.p()},n.prototype.j=function(e){this.a&&(this.b.fillRect(e.x-this.o,e.y-this.o,this.o,this.o),this.g.push(e))},n.prototype.k=function(e){return this.a?(this.j(e),this.a=!1,this.b.restore(),!0):!1},n.prototype.m=function(){return this.g},n.prototype.n=function(e){this.b.save(),this.p();for(var t=0;t<e.length;t++)this.b.fillRect(e[t].x-this.o,e[t].y-this.o,this.o,this.o);this.b.restore()},a.prototype.h=function(e){this.a=!0,this.g.length=0,this.g.push(e)},a.prototype.q=function(e,t,i){var n=Math.min(e.x,t.x),a=Math.min(e.y,t.y),o=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);i.strokeRect(n,a,o,r)},a.prototype.j=function(e){this.a&&(this.e.clearRect(0,0,this.f.width,this.f.height),this.q(this.g[0],e,this.e))},a.prototype.k=function(e){return this.a?(this.j(e),this.a=!1,this.b.drawImage(this.f,0,0),this.e.clearRect(0,0,this.f.width,this.f.height),this.g.push(e),!0):!1},a.prototype.m=function(){return this.g},a.prototype.n=function(e){this.q(e[0],e[1],this.b)},o.prototype.h=function(e){this.a=!0,this.g.length=0,this.g.push(e)},o.prototype.r=function(e,t,i){var n=e.x,a=e.y,o=Math.abs(n-t.x),r=Math.abs(a-t.y),s=Math.max(o,r);i.arc(n,a,s,0,2*Math.PI,!1),i.stroke()},o.prototype.j=function(e){this.a&&(this.e.clearRect(0,0,this.f.width,this.f.height),this.e.beginPath(),this.r(this.g[0],e,this.e))},o.prototype.k=function(e){return this.a?(this.j(e),this.a=!1,this.b.drawImage(this.f,0,0),this.e.clearRect(0,0,this.f.width,this.f.height),this.g.push(e),!0):!1},o.prototype.m=function(){return this.g},o.prototype.n=function(e){this.b.beginPath(),this.r(e[0],e[1],this.b)},r.prototype.h=function(e){this.b.beginPath(),this.b.moveTo(e.x,e.y),this.a=!0,this.g.length=0,this.g.push(e)},r.prototype.j=function(e){this.a&&(this.b.lineTo(e.x,e.y),this.b.stroke(),this.g.push(e))},r.prototype.k=function(e){return this.a?(this.j(e),this.a=!1,this.g.length>2?!0:!1):!1},r.prototype.m=function(){return this.g},r.prototype.n=function(e){this.b.beginPath(),this.b.moveTo(e[0].x,e[0].y);for(var t=1;t<e.length;t++)this.b.lineTo(e[t].x,e[t].y);this.b.stroke()},s.prototype.v=function(){this.w&&this.z&&(this.w.clearRect(0,0,this.A.width,this.A.height),this.z.clearRect(0,0,this.B.width,this.B.height))},s.prototype.h=function(e){var i=t(e);this.C.h(i)},s.prototype.j=function(e){var i=t(e);this.C.j(i)},s.prototype.k=function(e){var i=t(e);if(this.C.k(i)){var n=this.C.m();if(n.length>0){var a={shape:this.D,color:this.F,linewidth:this.G,coords:n,width:this.A.width,height:this.A.height};this.u(a)}}},s.prototype.H=function(e,t){var s=this;this.A=e,this.B=t,this.w=this.A.getContext("2d"),this.z=this.B.getContext("2d"),this.I=new r(this.w,this.z,this.B),this.J=new i(this.w,this.z,this.B),this.K=new a(this.w,this.z,this.B),this.L=new o(this.w,this.z,this.B),this.M=new n(this.w,this.z,this.B),t.addEventListener("mousedown",s.h.bind(s),!1),t.addEventListener("mousemove",s.j.bind(s),!1),t.addEventListener("mouseup",s.k.bind(s),!1),t.addEventListener("mouseleave",s.k.bind(s),!1)},s.prototype.N=function(e,t){this.s.width=e,this.s.height=t,this.t.drawImage(this.A,0,0,e,t),this.A.width=e,this.A.height=t,this.w.drawImage(this.s,0,0),this.B.width=e,this.B.height=t,this.O(this.D,this.F,this.G)},s.prototype.n=function(e){if("image"===e.shape)return void this.P(e.coords,!1);this.w.save();var t=this.A.width/e.width,i=this.A.height/e.height;switch(this.w.strokeStyle=e.color,this.w.fillStyle=e.color,this.w.lineWidth=e.linewidth,this.w.scale(t,i),e.shape){case"pencil":this.I.n(e.coords);break;case"line":this.J.n(e.coords);break;case"rectangle":this.K.n(e.coords);break;case"circle":this.L.n(e.coords);break;case"eraser":this.M.n(e.coords);break;case"text":var n=.02*e.width+4*parseInt(e.linewidth,10);this.w.font=n+"px sans-serif",this.w.fillText(e.coords.text,e.coords.x,e.coords.y)}this.w.restore()},s.prototype.O=function(e,t,i){switch(e){case"pencil":this.C=this.I;break;case"line":this.C=this.J;break;case"rectangle":this.C=this.K;break;case"circle":this.C=this.L;break;case"eraser":this.C=this.M;break;default:return}this.D=e,this.F=t,this.G=i,this.w&&this.z&&(this.w.strokeStyle=t,this.w.lineWidth=i,this.z.strokeStyle=t,this.z.lineWidth=i)},s.prototype.Q=function(e){var t=e.width,i=e.height,n=t/i,a=this.A.width,o=this.A.height,r=a/o,s=0,c=0;r>n?(i=o,t=Math.floor(n*o),s=Math.floor((a-t)/2)):(t=a,i=Math.floor(a/n),c=Math.floor((o-i)/2)),this.w.drawImage(e,s,c,t,i)},s.prototype.P=function(e,t){var i=this,n=new Image;n.onload=function(){i.Q(n);var a={shape:"image",coords:e};t&&i.u(a)},n.src=e},s.prototype.R=function(e){var t=this,i=new FileReader;i.onload=function(){t.P(i.result,!0)},i.readAsDataURL(e)},s.prototype.S=function(e,t,i,n,a){this.w.font=.02*this.A.width+4*parseInt(a,10)+"px sans-serif",this.w.fillStyle=n,this.w.fillText(e,t,i);var o={shape:"text",color:n,linewidth:a,coords:{text:e,x:t,y:i},width:this.A.width,height:this.A.height};this.u(o)},e.Whiteboard=s}(window),function(e){function t(e,t){this.T=null,this.U=null,this.V=null,this.W=null,this.X=e,this.Y=t,this.Z="480p",this.$="",this._="",this.aa=-1,this.ba=!1,this.ca=[];var i=this;window.addEventListener("message",i.da.bind(i),!1)}function i(e){for(var t=["a=ssrc-group:","a=ssrc:"],i=0;i<t.length;i++)if(-1!==e.indexOf(t[i])||e.length<=2)return"";return e}function n(e){navigator.mediaDevices.enumerateDevices().then(function(t){e(t.length>0&&t[0].label.length>0?!0:!1)})}var a=1,o=11e3,r={"180p":{width:320,height:180},"240p":{width:426,height:240},"270p":{width:480,height:270},"360p":{width:640,height:360},"480p":{width:854,height:480},"540p":{width:960,height:540},"720p":{width:1280,height:720}};t.prototype.da=function(e){if(e.origin===window.location.origin)if("WebRTCRequest"===e.data.type)this.aa=e.data.request;else if("WebRTCSource"===e.data.type){if(this.aa=-1,""===e.data.source)return void this.X({type:"shareGetUserMediaFailed",error:{name:"UserCancelled"}});var t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:event.data.source,maxWidth:1280,maxHeight:720}}};this.ea(this.fa,t)}},t.prototype.ga=function(e){for(var t=0;t<e.length;t++){var i=0,n=e[t].getAudioTracks();for(i=0;i<n.length;i++)this.ha("Stopping Audio Stream with id - "+n[i].id),n[i].stop();for(n=e[t].getVideoTracks(),i=0;i<n.length;i++)this.ha("Stopping Video Stream with id - "+n[i].id),n[i].stop()}},t.prototype.ia=function(e){this.Z=e},t.prototype.ja=function(e){e=e||this.Z;var t=r[e].width,i=r[e].height;if(this.ha("Getting UserMedia for "+t+" x "+i),"firefox"===webrtcDetectedBrowser){var n={width:{ideal:t,max:t},height:{ideal:i,max:i},frameRate:{min:15,ideal:15}};return this.$.length>0&&(n.deviceId=this.$),n}var a=[{minHeight:i},{minWidth:t}],o={maxHeight:i,maxWidth:t,minFrameRate:15},s={optional:a,mandatory:o};return this.$.length>0&&s.optional.push({sourceId:this.$}),s},t.prototype.ka=function(e,t){var i,n=this,a=function(e){var t=n.T?n.T.iceConnectionState:"closed";n.ha("Main ICE state: "+t),n.Y("MainIceState:"+t),n.X({type:"mainIceConnectionState",state:t})};t&&(i={iceServers:[t]}),n.la(),n.T=new RTCPeerConnection(i),n.T.onaddstream=n.ma.bind(n),n.T.oniceconnectionstatechange=a,n.T.onsignalingstatechange=function(){n.ha("Main signaling state: "+(null!==n.T?n.T.signalingState:"closed"))},n.na=1},t.prototype.ha=function(e){console.log((new Date).toISOString()+" - WebRTC: ",e)},t.prototype.oa=function(e){console.error((new Date).toISOString()+" - WebRTC: ",e)},t.prototype.pa=function(e){var t={type:"localStream",stream:e};this.X(t)},t.prototype.qa=function(e,t){var i=this;return null!==i.V?void e(i.V):(void 0===t&&(t={audio:!0,video:i.ja()},this._.length>0&&(t.audio.deviceId=this._)),void navigator.mediaDevices.getUserMedia(t).then(function(t){i.V=t,i.pa(t),i.Y("localStream"),e(t)}).catch(function(t){i.Y("pc:gumFailed"+t.name),e(null,t),i.oa("getUserMedia failed "+t.name),console.dir(t)}))};var s=function(e,t,n,a){for(var r=t.sdp.split("\r\n"),s=[],c=[],d=!1,h="",u=0;u<r.length;u++)if(-1!==r[u].indexOf("m=video ")&&(d=!0),d){var p=i(r[u]);p.length>0&&(s.push(p),c.push(p))}else{s.push(r[u]),c.push(r[u]);var l=r[u].match(/a=ssrc:\d+ cname:(\S+)/);l&&l.length>1&&(h=l[1])}s.push("a=x-google-flag:conference"),c.push("a=x-google-flag:conference");for(var f=[],p=1;e>=p;p++){var b=o*p;f.push([b,b+1])}console.log("SSRCs for simulcast - "+JSON.stringify(f));for(var g=a.getVideoTracks(),y="a=ssrc-group:SIM",u=0;u<f.length;u++)y+=" ",y+=f[u][0];s.push(y);for(var m=0;m<f.length;m++){var v="a=ssrc-group:FID "+f[m][0]+" "+f[m][1];s.push(v),c.push(v);for(var w=0;2>w;w++){var C="a=ssrc:"+f[m][w]+" ";s.push(C+"cname:"+h),s.push(C+"msid:"+a.id+" "+g[0].id),s.push(C+"mslabel:"+a.id),s.push(C+"label:"+g[0].id);var I="remoteVideo"+(m+1),S="remoteVideo"+(m+1)+"v0";c.push(C+"cname:"+h+m),c.push(C+"msid:"+I+" "+S),c.push(C+"mslabel:"+I),c.push(C+"label:"+S)}}s.push(""),c.push(""),t.sdp=s.join("\r\n"),n.sdp=c.join("\r\n")},c=function(e){return e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:64\r\n")};t.prototype.ra=function(e,t,i){var n=this,o={offerToReceiveAudio:1,offerToReceiveVideo:t};"chrome"===webrtcDetectedBrowser&&(o.offerToReceiveAudio=!0,o.offerToReceiveVideo=!0),n.T.createOffer(o).then(function(o){if(o.sdp=c(o.sdp),t>1)if(a&&e>1&&"chrome"===webrtcDetectedBrowser&&n.V.getVideoTracks().length>0){var r={type:o.type,sdp:""};s(e,o,r,n.V),i(r)}else i({type:"offer",sdp:o.sdp});else i({type:"offer",sdp:o.sdp});n.T.setLocalDescription(o).then(function(){n.Y("MainOfferSet")}).catch(function(e){n.Y("MainOfferSetErr:"+e),n.oa(e)})}).catch(function(e){n.Y("MainOfferCreateErr:"+e),n.oa(e)})},t.prototype.sa=function(e){var t=this;t.T.createAnswer().then(function(i){i.sdp=c(i.sdp),e(i),t.T.setLocalDescription(i).then(function(){}).catch(t.oa.bind(t))}).catch(t.oa.bind(t))},t.prototype.ta=function(e,t,i){e.details||(e.details={layers:1,resolution:this.Z});var n=this.ja(e.details.resolution);this.ua(e,{audio:!0,video:n},t,i)},t.prototype.va=function(e,t,i){e.details||(e.details={}),e.details&&(e.details.layers=1),this.ua(e,{audio:!0,video:!1},t,i)},t.prototype.wa=function(e,t,i){e.details||(e.details={}),e.details&&(e.details.layers=1),this.ua(e,{audio:!1,video:!1},t,i)},t.prototype.xa=function(){var e="chrome"===webrtcDetectedBrowser||"IE"===webrtcDetectedBrowser?"planB":"unified";return e},t.prototype.ua=function(e,t,i,n){var a=this;this.ka(!0,e.iceServers);var o=a.xa(),r=function(){a.ha("Creating Offer by triggering negotiation"),a.ra(e.details.layers,i,function(e){n(e,o)})};return a.T.onicecandidate=function(e){if(e.candidate){var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};if(a.Y("MainIceCand"),a.ha("GetOfferSdp: "+JSON.stringify(t)),a.ba=!0,a.X({type:"mainCandidate",candidate:t}),a.ca.length>0)for(var i=0;i<a.ca.length;i++)a.ya(a.ca[i])}else a.Y("MainIceDone:"+a.ba),a.ha("GetOfferSdp: ICE Done candidates gathered="+a.ba),a.ba||a.X({type:"mainCandidateGatheringError"})},t.audio||t.video?void a.qa(function(e,t){return null===e?void n(null,o,t):(a.V=e,a.T.onnegotiationneeded=r,void a.T.addStream(e))},t):void r()},t.prototype.za=function(e,t,i){this.Aa(e,t,{audio:!0,video:this.ja()},i)},t.prototype.Ba=function(e,t,i){this.Aa(e,t,{audio:!0,video:!1},i)},t.prototype.Aa=function(e,t,i,n){var a=this;this.ka(!1,e);var o=new RTCSessionDescription(t);a.T.onicecandidate=function(e){if(e.candidate){var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};a.ha("HandleOfferSdp: "+JSON.stringify(t)),a.X({type:"mainCandidate",candidate:t})}else a.ha("HandleOfferSdp: ICE Done")},a.T.setRemoteDescription(o).then(function(){a.qa(function(e,t){return null===e?void n(null,null,t):(a.V=e,a.T.addStream(e),void a.sa(n))},i)}).catch(a.oa.bind(a))},t.prototype.Ca=function(e,t){var i=this,n=new RTCSessionDescription(e);i.T.setRemoteDescription(n).then(function(){i.Y("MainRemoteSet"),t()}).catch(function(e){i.Y("MainRemoteSetErr:"+e),i.oa(e)})},t.prototype.ma=function(e){console.log("WebRTC: Stream Added "+e.stream.id+" Video Tracks = "+e.stream.getVideoTracks().length);var t={type:"remoteStream",stream:e.stream,id:e.stream.id,label:e.stream.id,index:this.na};0===e.stream.getVideoTracks().length?t.type="remoteAudioStream":this.na+=1,this.X(t)},t.prototype.la=function(){if(null!==this.T){try{this.ga(this.T.getRemoteStreams()),this.ga(this.T.getLocalStreams()),this.T.close()}catch(e){this.ha("disconnectCall_ exception: "+e),console.dir(e)}this.T=null}null!==this.V&&(this.V=null),this.ba=!1,this.ca.length=0,this.Da(function(){})},t.prototype.Ea=function(){return!!getUserMedia},t.prototype.Fa=function(e){e("chrome"===webrtcDetectedBrowser?document.getElementById("webrtc_screen_share_extension_installed")?!0:!1:!0)},t.prototype.Ga=function(e,t){if("chrome"===webrtcDetectedBrowser)return this.fa=t,void(-1===this.aa&&window.postMessage({type:"WebRTCGetSource",sources:e},"*"));if("firefox"===webrtcDetectedBrowser){var i={video:{mediaSource:"window",mozMediaSource:"window"}};return 1===e.length&&"screen"===e[0]&&(i.video.mediaSource="screen",i.video.mozMediaSource="screen"),void this.ea(t,i)}if("IE"===webrtcDetectedBrowser){var i={audio:!1,video:{optional:[{sourceId:"WebRTCScreenCapture"}]}};return void this.ea(t,i)}},t.prototype.Da=function(e){return-1!==this.aa?(window.postMessage({type:"WebRTCCancelGetSource",request:this.aa},"*"),this.aa=-1,void e({})):(null!==this.U&&(this.U.close(),this.U=null),null!==this.W&&(this.ga([this.W]),this.W=null),void e({type:"stopShare"}))},t.prototype.Ha=function(e){console.log("WebRTC: Share Stream Added "+e.stream.id);var t={type:"remoteShareStream",stream:e.stream};this.X(t)},t.prototype.Ia=function(){var e=this;e.U.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1}).then(function(t){var i={type:"shareOffer",sdp:{type:"offer",sdp:t.sdp}};e.X(i),e.U.setLocalDescription(t).then(function(){e.Y("ShareOfferSet")}).catch(function(t){e.Y("ShareOfferSetErr:"+t),e.oa(t)})}).catch(function(t){e.Y("ShareOfferCreateErr:"+t),e.oa(t)})},t.prototype.Ja=function(e,t){var i=this;this.ha("Share: iceServers: "+JSON.stringify(e));var n={iceServers:[e]},a=function(e){var n=i.U?i.U.iceConnectionState:"closed";if(i.Y("ShareIceState:"+n),i.ha("Share ICE state: "+n),i.X({type:"shareIceConnectionState",state:n}),"failed"===n&&!t){var a={type:"localShareStreamEnded",reason:"iceFailed"};i.X(a)}};null!==i.U&&(i.ga([i.W]),i.U.close()),i.U=new RTCPeerConnection(n),t&&(i.U.onaddstream=i.Ha.bind(i)),i.U.oniceconnectionstatechange=a},t.prototype.ea=function(e,t){var i=this;i.Ja(e,!1),i.U.onnegotiationneeded=function(){i.ha("share: onnegotiationneeded"),i.Ia()},i.U.onicecandidate=function(e){if(e.candidate){var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};i.ha("StartShare: "+JSON.stringify(t)),i.X({type:"shareCandidate",candidate:t})}else i.ha("StartShare: ICE Done")},navigator.mediaDevices.getUserMedia(t).then(function(e){i.Y("gumShare"),i.W=e,e.oninactive=function(){var e={type:"localShareStreamEnded",reason:"userEnded"};i.X(e)},i.U.addStream(e);var t={type:"localShareStream",stream:e};i.X(t)}).catch(function(e){i.Y("gumShareErr:"+e),i.X({type:"shareGetUserMediaFailed",error:e}),i.oa(e)})},t.prototype.Ka=function(e,t,i){var n=this;n.Ja(e,!0);var a=new RTCSessionDescription(t);n.U.onicecandidate=function(e){if(e.candidate){var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};n.ha("HandleShare: "+JSON.stringify(t)),n.X({type:"shareCandidate",candidate:t})}else n.ha("HandleShare: ICE Done")},n.U.setRemoteDescription(a).then(function(){n.U.createAnswer().then(function(e){i(e),n.U.setLocalDescription(e).then(function(){}).catch(n.oa.bind(n))}).catch(n.oa.bind(n))}).catch(n.oa.bind(n))},t.prototype.La=function(e){var t=this,i=new RTCSessionDescription(e);t.U.setRemoteDescription(i).then(function(){t.Y("ShareRemoteSet")}).catch(function(e){t.Y("ShareRemoteSetErr:"+e),t.oa(e)})},t.prototype.Ma=function(){var e=this.T.getRemoteStreams(),t=e[e.length-1],i={type:"remoteShareStream",stream:t};this.X(i)},t.prototype.Na=function(){var e=this.T.getLocalStreams();return e[0].getVideoTracks().length>0?e[0].getVideoTracks()[0]:e.length>1&&e[1].getVideoTracks().length>0?e[1].getVideoTracks()[0]:void 0},t.prototype.Oa=function(){this.Na().enabled=!1},t.prototype.Pa=function(){this.T.getLocalStreams()[0].getAudioTracks()[0].enabled=!1},t.prototype.Qa=function(){},t.prototype.Ra=function(){this.Na().enabled=!0},t.prototype.Sa=function(){this.T.getLocalStreams()[0].getAudioTracks()[0].enabled=!0},t.prototype.Ta=function(){},t.prototype.ya=function(e){return this.ha("HandleMainCandidate: "+JSON.stringify(e)),this.ba===!1?(this.ha("HandleMainCandidate: No LOCAL candidates, so storing"),void this.ca.push(e)):void(null!==this.T&&this.T.addIceCandidate(new RTCIceCandidate(e),function(){console.log("MAIN: Ice candidate added successfully")},function(e){console.log("MAIN: Ice candidate add FAILED",e),console.dir(e)}))},t.prototype.Ua=function(e){this.ha("HandleShareCandidate: "+JSON.stringify(e)),null!==this.U&&this.U.addIceCandidate(new RTCIceCandidate(e),function(){console.log("MAIN: Ice candidate added successfully")},function(e){console.log("MAIN: Ice candidate add FAILED",e),console.dir(e)})},t.prototype.Va=function(e){var t=this,i={status:0,audioInputDevices:[],videoInputDevices:[],audioOutputDevices:[]},a=function(n){navigator.mediaDevices.enumerateDevices().then(function(a){for(var o=0;o<a.length;o++)switch(t.ha("Devices["+(o+1)+"] kind: "+a[o].kind+" label: "+a[o].label),a[o].kind){case"audioinput":i.audioInputDevices.push({id:a[o].deviceId,label:a[o].label});break;case"videoinput":i.videoInputDevices.push({id:a[o].deviceId,label:a[o].label});break;case"audiooutput":i.audioOutputDevices.push({id:a[o].deviceId,label:a[o].label})}i.audioOutputDevices.length<=0&&i.audioOutputDevices.push({id:"default",label:"Default"}),e(i),n()}).catch(function(t){console.log(t),i.status=t,e(i),n()})};n(function(n){n?a(function(){}):navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){a(function(){t.ga([e])})}).catch(function(t){console.log(t),i.status=t,e(i)})})},t.prototype.Wa=function(e){this._=e},t.prototype.Xa=function(e){this.$=e},t.prototype.Ya=function(e){this.T.addStream(e)},t.prototype.Za=function(e,t,i){var n=this;if("stable"!==n.T.signalingState)return n.oa("signaling state not stable "+n.T.signalingState),!1;e.details||(e.details={layers:1,resolution:this.Z});var a={audio:!1,video:this.ja(e.details.resolution)},o=this.xa(),r=function(){n.ha("Renegotiating offer by triggering"),n.ra(e.details.layers,t,function(e){i(e,o)})};return n.V=null,n.qa(function(e,t){return null===e?void i(null,o,t):(n.T.onnegotiationneeded=r,void n.Ya(e))},a),!0},t.prototype.$a=function(e,t){var i=this,n=new RTCSessionDescription(e);i.T.onicecandidate=function(){i.ha("Renegotiating - Received ice candidate")},i.T.setRemoteDescription(n).then(function(){i.T.createAnswer().then(function(e){t(e),i.T.setLocalDescription(e).then(function(){}).catch(i.oa.bind(i))}).catch(i.oa.bind(i))}).catch(function(e){i.oa("setRemoteDescription in handleAddVideoToCall failed "+e),console.dir(e)})},t.prototype._a=function(e){var t=this,i=new RTCSessionDescription(e);t.T.setRemoteDescription(i).then(function(){}).catch(t.oa.bind(t))},t.prototype.ab=function(){return this.T?this.T.getStats.bind(this):null},e.WebRtcPeerConn=t}(window),function(e){function t(e,t){this.eb=e,this.u=t,this.fb=null,this.gb={}}var i=function(e,t){t.id=e.bb,t.session=e.cb;var i=JSON.stringify(t);null!==e.db?(console.log("CM Msg Tx = "+i),e.db.send(i)):console.log("CM WS NULL Msg Tx = "+i)};t.PRESENTER_MODE="presenter",t.GROUP_MODE="group",t.prototype.sendMsg=function(e){i(this.eb,e)},t.prototype.handleMessage=function(e){switch(e.type){case"callMgrConferencesResponse":this.fb&&this.fb(e.conferences);break;case"userUnavailableResponse":"callMgrConferenceParticipantsRequest"===e.request.type&&this.gb.hasOwnProperty(e.request.confId)&&this.gb[e.request.confId](e.request.confId,[]);break;case"callMgrConferenceParticipantsResponse":this.gb.hasOwnProperty(e.confId)&&(e.participants=this.eb.formatParticipants(e.participants),this.gb[e.confId](e.confId,e.participants));break;case"callMgrConferencesUpdated":this.u&&this.u(e);break;case"callMgrParticipantsUpdated":this.u&&(e.participants=this.eb.formatParticipants(e.participants),this.u(e));break;case"callMgrParticipantAudioMuted":case"callMgrParticipantAudioUnmuted":case"callMgrParticipantVideoMuted":case"callMgrParticipantVideoUnmuted":case"callMgrParticipantHandRaised":if(this.u){var t=[e.participant];e.participant=this.eb.formatParticipants(t)[0],this.u(e)}}},t.prototype.getConferences=function(e,t){this.fb=t,this.sendMsg({type:"callMgrConferencesRequest",conferences:e})},t.prototype.getConferenceParticipants=function(e,t){this.gb[e]=t,this.sendMsg({type:"callMgrConferenceParticipantsRequest",confId:e})},t.prototype.muteAudioInConference=function(e,t){this.sendMsg({type:"callMgrConferenceMute",confId:e,audioMuted:t,callId:-1})},t.prototype.muteVideoInConference=function(e,t){
    this.sendMsg({type:"callMgrConferenceMute",confId:e,videoMuted:t,callId:-1})},t.prototype.muteUserAudioInConference=function(e,t,i){this.sendMsg({type:"callMgrConferenceMute",confId:e,audioMuted:i,callId:t})},t.prototype.muteUserVideoInConference=function(e,t,i){this.sendMsg({type:"callMgrConferenceMute",confId:e,videoMuted:i,callId:t})},t.prototype.hangUpUserInConference=function(e,t){this.sendMsg({type:"callMgrConferenceHangUp",confId:e,callId:t})},t.prototype.hangUpAllInConference=function(e){this.sendMsg({type:"callMgrConferenceHangUp",confId:e,callId:-1})},t.prototype.setConferenceMode=function(e,t){this.sendMsg({type:"callMgrConferenceMode",confId:e,mode:t})},t.prototype.setPresenter=function(e,t){this.sendMsg({type:"callMgrConferenceMode",confId:e,presenterId:t})},t.prototype.acknowledgeRaisedHand=function(e,t,i){this.sendMsg({type:"callMgrConferenceAckRaiseHand",confId:e,userId:t,audioUnmuted:i})},e.CallManager=t}(window),function(e){function t(){}function i(){var e=this;return e.Rb=!1,"Notification"in window?void("granted"===Notification.permission?e.Rb=!0:"denied"!==Notification.permission&&Notification.requestPermission(function(t){"granted"===t&&(e.Rb=!0)})):void console.log("NOTIFICATION NOT SUPPORTED!!")}function n(e,i){this.wb=!1,this.X=i,this.db=null,this.bb="",this.xb="",this.cb="";var a=this;this.T=new WebRtcPeerConn(function(e){v(a,e)},function(e){S(a,e)}),this.Qb=e,this.ib="",this.hb="",this.rb=null,this.jb=null,this.nb=!1,this.kb="",this.lb=!1,this.mb=!1,this.Eb=null,this.Hb=null,this.Jb=null,this.Kb=null,this.yb=null,this.zb=null,this.sb=null,this.Nb=null,this.Ob=null,this.Pb=null,this.Lb=null,this.ob=!1,this.pb=!1,this.qb=n.GROUP_MODE_PARTICIPANT,this.vb=[],this.Bb=null;var a=this;this.ub=new Whiteboard(function(e){m(a,e)});var o=screen.width;screen.height>o&&(o=screen.height),1281>=o?this.Ib=4:this.Ib=s,h(" MaxDisplays: "+this.Ib),window.addEventListener("unload",function(){var e=l(a),i=f(a);(e.length>0||i.length>0)&&L(a,t)})}var a="#FF0000",o="pencil",r=1,s=6,c=1e4,d=6,h=function(e){console.log((new Date).toISOString()+" - Client: ",e)},u=function(e,t){e.hb="",e.ib=t},p=function(e,t){e.hb=t,e.ib=""},l=function(e){return e.ib},f=function(e){return e.hb},b=function(e,t){t.id=e.bb,t.session=e.cb;var i=JSON.stringify(t);null!==e.db?(h("Msg Tx = "+i),e.db.send(i)):h("WS NULL Msg Tx = "+i)},g=function(e){null!==e.db&&(e.db.onmessage=t,e.db.onclose=t,e.db.onerror=t,e.db.close(),e.db=null)},y=function(e){e.ib="",e.hb="",e.jb=null,e.kb="",e.lb=!1,e.mb=!1,e.nb=!1,e.ob=!1,e.pb=!1,e.qb=n.GROUP_MODE_PARTICIPANT,e.rb=null,e.sb=null,e.tb=null,e.ub.v(),e.setWhiteboardShape(o,a,r),e.vb.length=0,e.wb&&(g(e),I(e))},m=function(e,t){var i={type:"userWhiteboard",userId:l(e),draw:t};i.userId.length<=0&&(i={type:"confWhiteboard",confId:f(e),name:e.xb,draw:t}),b(e,i)},v=function(e,t){switch(h("PeerConnectionCallback: "+t.type),t.type){case"localStream":e.yb&&e.yb(t);break;case"remoteStream":case"remoteAudioStream":e.yb&&e.yb(t);break;case"shareGetUserMediaFailed":e.sb&&e.sb(t);break;case"localShareStream":e.lb=!0,e.sb&&e.sb(t);break;case"localShareStreamEnded":e.stopShare(function(){}),e.sb&&e.sb(t);break;case"shareOffer":var i={type:"userShareOfferSdp",userId:l(e)};i.userId.length<=0&&(i={type:"confShareOfferSdp",confId:f(e)}),i.shareName=e.xb,i.sdp=t.sdp,b(e,i);break;case"remoteShareStream":t.shareName=e.kb,e.yb(t);break;case"mainCandidate":var n={candidate:t.candidate},a=l(e);a.length>0?(n.type="userMainCandidate",n.userId=a):(n.type="confMainCandidate",n.confId=f(e)),b(e,n);break;case"mainCandidateGatheringError":e.yb(t);break;case"shareCandidate":var n={candidate:t.candidate},a=l(e);a.length>0?(n.type="userShareCandidate",n.userId=a):(n.type="confShareCandidate",n.confId=f(e)),b(e,n);break;case"mainIceConnectionState":e.yb(t),"failed"===t.state&&(h("peerConnectionCallback MAIN ICE FAILED"),e.db.close(),E(e,"ICE_FAILED"));break;case"shareIceConnectionState":e.yb(t);break;default:h("UNHANDLED peerConnectionCallback - "+t.type)}},w=function(e,t){switch(t.type){case"callProceeding":break;case"localStream":e.zb&&e.zb(t);break;case"rejectCallResponse":case"ignoreCallResponse":e.yb=e.zb,e.zb=null;break;case"acceptCallResponse":b(e,{type:"disconnectCallRequest",userId:l(e)}),e.T.la();break;case"answerSdp":e.yb=e.zb;break;default:h("TransferCallBack - UNHANDLED MSG - "+t.type)}},C=function(e,t,i){void 0===e.Ab&&(e.Ab=0);var n=function(){e.Bb=setTimeout(function(){e.Ab++,e.Ab>d?(e.db.close(),E(e,"PING_TIMEOUT"),e.Ab=0):C(e,!1)},c)},a=function(){b(e,{type:"ping",data:{c:e.Cb++,i:e.Ab,d:Date.now(),rtt:e.Db,l:e.vb}}),n()};I(e),t?(e.Ab=0,e.Db=Date.now()-i.d,e.vb.length=0,e.Bb=setTimeout(a,c)):a()},I=function(e){null!==e.Bb&&(clearTimeout(e.Bb),e.Bb=null)},S=function(e,t){e.vb.push(""+Date.now()+":"+t)},M=function(e,t,i){e.Eb=i;var n={type:"turnCredentialsRequest",confId:t};b(e,n)},T=function(e,t,i){var n=function(n,a,o){if(null===n)return e.yb({type:"getUserMediaFailed",error:o}),void L(e,e.yb);var r={type:"offerSdp",userId:t,sdp:n,callType:i};e.yb&&e.yb(r),b(e,r)};M(e,void 0,function(t){"Voice"===i?e.T.va(t,0,n):e.T.ta(t,1,n)})},R=function(e,t){var i=function(i,n,a){if(null===i)return e.yb({type:"getUserMediaFailed",error:a}),void L(e,e.yb);var o={type:"answerSdp",userId:t.id,sdp:i,callType:t.callType};e.yb&&e.yb(o),b(e,o)};M(e,void 0,function(n){"Voice"===t.callType?e.T.Ba(n.iceServers,t.sdp,i):e.T.za(n.iceServers,t.sdp,i)})},D=function(e,t){var i=function(i,n,a){if(null===i)return e.yb({type:"getUserMediaFailed",error:a}),void L(e,e.yb);var o={type:"answerSdpWithVideo",userId:t.id,sdp:i,callType:t.callType};e.yb&&e.yb(o),b(e,o)};e.T.$a(t.sdp,i)},k=function(e,t){e.T.Ca(t.sdp,function(){if("videoConfResponse"===t.type&&(e.qb=t.mode,t.mode===n.PRESENTER_MODE_PARTICIPANT)){var i=[{width:screen.width,height:screen.height}];e.ob=!0,e.muteMicrophone(),e.setCurrentDisplays(1,i),e.yb({type:"confModeChanged",mode:t.mode})}})},U=function(e,t){e.T._a(t.sdp)},x=function(e,t){e.kb=t.shareName,M(e,void 0,function(i){e.T.Ka(i.iceServers,t.sdp,function(i){var n={type:"userShareAnswerSdp",userId:t.id,sdp:i};b(e,n)})})},O=function(e,t){e.Fb&&e.Fb.Gb();var i={type:"disconnectCallResponse",userId:t.id};b(e,i),e.T.la(),null!==e.yb?e.yb(t):e.X(t),y(e)},P=function(e,a){h("Msg Rx = "+a.data);var o=JSON.parse(a.data);switch(o.type){case"loginResponse":0!==o.status&&g(e),e.Hb&&(e.cb=o.session,e.bb=o.id,e.xb=o.name,o.maxDisplays<e.Ib&&(e.Ib=o.maxDisplays),o.currentDisplays=e.Ib,e.T.ia(o.resolution),0===o.status&&(e.Cb=1,e.Db=-1,e.vb.length=0,S(e,"loginResponse"),C(e,!1),e.wb||(e.Fb=new i)),e.Hb(o),e.Hb=null);break;case"pong":C(e,!0,o.data);break;case"contactsResponse":e.Jb&&(e.Jb(o.contacts),e.Jb=null);break;case"recordingsResponse":e.Kb&&(e.Kb(o.recordings),e.Kb=null);break;case"contactUpdated":case"conferenceUpdated":e.wb||e.X(o);break;case"userUnavailableResponse":e.yb&&(e.yb(o),e.yb=null),e.Lb&&e.Lb.handleMessage(o);break;case"callProceeding":e.yb&&e.yb(o);break;case"acceptCallResponse":e.yb(o),u(e,o.id),e.wb&&e.yb({type:"remoteGuestUser",guestName:o.name}),T(e,o.id,o.callType);break;case"answerSdp":k(e,o);break;case"answerSdpWithVideo":U(e,o);break;case"videoConfResponse":if(e.yb(o),0===o.status){k(e,o);for(var r=[{width:screen.width,height:screen.height}],s=1;s<e.Ib;s++)r.push({width:0,height:0});e.setCurrentDisplays(e.Ib,r)}else e.T.la(),y(e);break;case"addVideoToConfResponse":e.T._a(o.sdp);break;case"rejectCallResponse":case"ignoreCallResponse":e.yb(o),y(e);case"disconnectCallResponse":break;case"disconnectConfResponse":e.hb.length>0&&(e.yb(o),e.T.la(),y(e));break;case"licenseStatus":e.yb&&e.yb(o),L(e,t);break;case"recordingStarted":case"recordingStopped":e.yb&&e.yb(o);break;case"participantsUpdated":e.yb&&(o.participants=e.formatParticipants(o.participants),e.yb(o));break;case"conferenceEnded":e.yb&&(e.yb(o),e.T.la(),y(e));break;case"voiceCallRequest":case"videoCallRequest":if(e.ib===o.id&&e.bb===o.userId)break;if(""!==e.ib||""!==e.hb){var o={type:"rejectCallResponse",userId:o.id};b(e,o)}else u(e,o.id),e.wb?(e.yb({type:"remoteGuestUser",guestName:o.name}),"voiceCallRequest"===o.type?e.answerCall("Voice",e.yb):e.answerCall("Video",e.yb)):(e.Fb.Mb("Incoming Call","Incoming Call from "+o.name),e.yb=null,e.X(o));break;case"callAnswered":e.Fb.Gb(),y(e),e.X(o);break;case"turnCredentialsResponse":if(null!==e.Eb){e.tb={};for(var c in o)if("object"==typeof o[c]){e.tb[c]={};for(var d in o[c])e.tb[c][d]=o[c][d]}else e.tb[c]=o[c];e.Eb(o)}break;case"offerSdp":e.yb&&e.yb(o),R(e,o);break;case"offerSdpWithVideo":D(e,o);break;case"disconnectCallRequest":O(e,o);break;case"userJoined":case"userLeft":e.X(o);break;case"activeTalkerList":0===e.kb.length&&o.shareName.length>0?(e.kb=o.shareName,e.T.Ma()):0===o.shareName.length&&e.kb.length>0&&(e.kb=""),e.yb(o);break;case"userFilesTransferRequest":case"confFilesTransferRequest":e.jb=o;case"userChatMessage":case"confChatMessage":case"userAudioMuted":case"userAudioUnmuted":case"userVideoMuted":case"userVideoUnmuted":case"userCaption":case"confCaption":case"userApplicationData":case"confApplicationData":e.yb(o);break;case"confAudioForceMuted":case"userAudioForceMuted":e.ob=!0,e.muteMicrophone(),e.yb(o);break;case"confAudioForceUnmuted":case"userAudioForceUnmuted":e.ob=!1,e.unmuteMicrophone(),e.yb(o);break;case"confVideoForceMuted":case"userVideoForceMuted":e.pb=!0,e.muteVideo(),e.yb(o);break;case"confVideoForceUnmuted":case"userVideoForceUnmuted":e.pb=!1,e.unmuteVideo(),e.yb(o);break;case"userShareOfferSdp":case"confShareOfferSdp":x(e,o);break;case"userShareAnswerSdp":case"confShareAnswerSdp":e.T.La(o.sdp);break;case"userStopShare":e.T.Da(function(){e.ub.v(),e.yb(o)});break;case"confStopShare":e.kb="",e.ub.v(),e.yb(o);break;case"userWhiteboard":case"confWhiteboard":e.ub.n(o.draw);break;case"userRecordingNotFound":case"userRecordingUnauthorized":break;case"userRecordingDeleted":case"confStartRecordingResponse":break;case"conferencesUpdated":case"recordingsUpdated":e.X(o);break;case"userMainCandidate":case"confMainCandidate":e.T.ya(o.candidate);break;case"userShareCandidate":case"confShareCandidate":e.T.Ua(o.candidate);break;case"userTransferCall":null!==e.rb&&(e.yb({type:"callTransferInProgress"}),e.zb=e.yb,e.yb=function(t){w(e,t)},e.rb.userId=l(e),b(e,e.rb));break;case"userAddConferenceDone":e.Nb&&(o.type="addConferenceDone",e.Nb(o));break;case"userDeleteConferenceDone":e.Ob&&(o.type="deleteConferenceDone",e.Ob(o));break;case"userModifyConferenceDone":e.Pb&&(o.type="modifyConferenceDone",e.Pb(o));break;case"confModeChanged":var r=[{width:screen.width,height:screen.height}];o.mode===n.GROUP_MODE_PARTICIPANT||o.mode===n.PRESENTER_MODE_PRESENTER||"presenterModeUndecided"===o.mode?(e.qb=o.mode,e.ob=!1,e.unmuteMicrophone(),e.setCurrentDisplays(e.Ib,r)):(e.qb=n.PRESENTER_MODE_PARTICIPANT,e.ob=!0,e.muteMicrophone(),e.setCurrentDisplays(1,r)),e.yb(o);break;case"confParticipantHandRaised":o.participant=e.formatParticipants([o.participant])[0],e.yb(o);break;case"confRaiseHandResponse":o.audioUnmuted?(e.ob=!1,e.unmuteMicrophone()):(e.ob=!0,e.muteMicrophone()),e.yb(o);break;case"callMgrConferencesResponse":case"callMgrConferenceParticipantsResponse":case"callMgrConferencesUpdated":case"callMgrParticipantsUpdated":case"callMgrParticipantAudioMuted":case"callMgrParticipantAudioUnmuted":case"callMgrParticipantVideoMuted":case"callMgrParticipantVideoUnmuted":case"callMgrParticipantHandRaised":e.Lb.handleMessage(o);break;default:h("UNHANDLED MSG FROM "+o.type)}},E=function(e,t){h("WebSocketClosed - "+t),e.db=null;var i=l(e),n=f(e),t={};(i.length>0||n.length>0)&&(i.length>0?(t.type="disconnectCallRequest",t.userId=i):(t.type="disconnectConfRequest",t.confId=n),O(e,t)),I(e),e.X({type:"connectionClosed"})},A=function(e,t){g(e);var i="wss://";"http:"===window.location.protocol&&(i="ws://"),e.db=new WebSocket(i+e.Qb+"/browser"),e.db.onerror=function(){E(e,"WS_ONERROR")},e.db.onopen=function(){e.db.onmessage=function(t){P(e,t)},e.db.onclose=function(){E(e,"WS_ONCLOSE")},b(e,t)}};i.prototype.Mb=function(e,t){this.Rb&&(this.Fb=new Notification(e,{body:t,icon:"/favicon.ico"}),this.Fb.onclick=function(){window.focus()})},i.prototype.Gb=function(){this.Rb&&this.Fb&&(this.Fb.close(),this.Fb=null)},n.GROUP_MODE_PARTICIPANT="groupModeParticipant",n.PRESENTER_MODE_PARTICIPANT="presenterModeParticipant",n.PRESENTER_MODE_PRESENTER="presenterModePresenter",n.prototype.disableNotification=function(){h("Intf: disableNotification"),this.Fb&&(this.Fb.Rb=!1)},n.prototype.isWebRtcSupported=function(){h("Intf: isWebRtcSupported");var e=this.T.Ea();return e},n.prototype.setCanvases=function(e,t){h("Intf: setCanvases c1="+e+" c2="+t),this.ub.H(e,t),this.setWhiteboardShape(o,a,r)},n.prototype.resizeCanvas=function(e,t){h("Intf: resizeCanvas "+e+" x "+t),this.ub.N(e,t)},n.prototype.setWhiteboardShape=function(e,t,i){h("Intf: setWhiteboardShape: "+e+" "+t+" "+i),this.ub.O(e,t,i)},n.prototype.drawImage=function(e){h("Intf: drawImage: "+e+"."),this.ub.R(e)},n.prototype.drawText=function(e,t,i,n,a){h("Intf: drawText: "+e+". "+t+","+i+" color:"+n+" width:"+a),this.ub.S(e,t,i,n,a)},n.prototype.uploadFiles=function(e,t){h("Intf: uploadFiles files="+e+" cb="+t);for(var i=0,n=[],a=[],o=function(e,t){return{total:e.total+t.total,loaded:e.loaded+t.loaded}},r=function(e,i){if(i.lengthComputable){n[e].total=i.total,n[e].loaded=i.loaded;var a=n.reduce(o),r=100*a.loaded/a.total;t({type:"progress",percent:Math.floor(r)})}},s=this,c=function(n,o){if(t({type:"status",status:0}),i+=1,i===e.length){var r={type:"userFilesTransferRequest",userId:l(s)};r.userId.length<=0&&(r={type:"confFilesTransferRequest",confId:f(s)}),r.files=a,b(s,r)}},d=function(e,i){t({type:"status",status:-1})},u=0;u<e.length;u++){n[u]={total:0,loaded:0},a.push(e[u].name);var p=new XMLHttpRequest;p.open("post","/fileupload?id="+s.bb+"&session="+s.cb+"&name="+e[u].name,!0),p.upload.addEventListener("progress",r.bind(void 0,u)),p.onload=c.bind(void 0,u),p.onerror=d.bind(void 0,u),p.send(e[u])}},n.prototype.downloadFile=function(e){if(h("Intf: downloadFile file="+e),this.jb&&-1!==this.jb.files.indexOf(e)){var t="/filedownload/"+e+"?session="+this.cb+"&id="+this.bb;t+="&user="+this.jb.id+"&name="+e,window.open(t)}},n.prototype.sendChat=function(e){h("Intf: sendChat txt="+e);var t={type:"userChatMessage",userId:l(this),name:this.xb,chat:e};t.userId.length<=0&&(t={type:"confChatMessage",confId:f(this),name:this.xb,chat:e}),b(this,t)},n.prototype.isShareEnabled=function(e){h("Intf: isShareEnabled");var t=this.T.Fa(e);return t},n.prototype.startShare=function(e){h("Intf: startShare cb="+e),this.sb=e;var t=this;S(t,"startShare"),M(t,void 0,function(e){t.T.Ga(["window","screen"],e.iceServers)})},n.prototype.startScreenShare=function(e){h("Intf: startScreenShare cb="+e),this.sb=e;var t=this;S(t,"startScreenShare"),M(t,void 0,function(e){t.T.Ga(["screen"],e.iceServers)})},n.prototype.stopShare=function(e){h("Intf: stopShare cb="+e);var t=this;if(S(t,"stopShare"),!t.lb)return h("NOT Sharing..."),void e();t.lb=!1;var i={type:"userStopShare",userId:l(t)};i.userId.length<=0&&(i={type:"confStopShare",confId:f(this)}),this.ub.v(),this.T.Da(function(n){"stopShare"===n.type&&b(t,i),e()})},n.prototype.startRecording=function(e){h("Intf: startRecording constraints="+JSON.stringify(e)),S(this,"startRec");var t={type:"userStartRecording",userId:l(this),constraints:e};t.userId.length<=0&&(t={type:"confStartRecording",confId:f(this),constraints:e}),this.mb=!0,b(this,t)},n.prototype.stopRecording=function(){h("Intf: stopRecording"),S(this,"stopRec");var e={type:"userStopRecording",userId:l(this)};e.userId.length<=0&&(e={type:"confStopRecording",confId:f(this)}),this.mb=!1,b(this,e)},n.prototype.deleteRecording=function(e){h("Intf: deleteRecording path="+e);var t={type:"userDeleteRecording",path:e};b(this,t)},n.prototype.setMaxDisplays=function(e){return h("Intf: setMaxDisplays c="+e),e>s?!1:(this.Ib=e,!0)},n.prototype.setCurrentDisplays=function(e,t){if(h("Intf: setCurrentDisplays i="+e+" r="+JSON.stringify(t)),this.qb===n.PRESENTER_MODE_PARTICIPANT&&(e=1),s>=e){this.Ib=e;var i={type:"confChangeDisplays",confId:f(this),maxDisplays:e,resolutions:t};return i.confId.length<=0?!1:(b(this,i),!0)}return!1},n.prototype.transferCall=function(){h("Intf: transferCall");var e=l(this);if(e.length<=0)return!1;var t={type:"userTransferCall",userId:e};return b(this,t),!0},n.prototype.raiseHand=function(){h("Intf: raiseHand");var e=f(this);if(e.length<=0)return!1;var t={type:"confRaiseHand",confId:e};return b(this,t),!0},n.prototype.login=function(e,t,i){h("Intf: login email="+e+" passwd="+t+" cb="+i),this.wb=!1;var n={type:"loginRequest",email:e,password:t};this.Hb=i,A(this,n)},n.prototype.guestLogin=function(e,t,i){h("Intf: guestLogin guestName="+e+" conferenceId="+t+" cb="+i),this.wb=!0;var n={type:"guestLoginRequest",name:e,confId:t};this.Hb=i,A(this,n)},n.prototype.createGuestUser=function(e,t){h("Intf: createGuestUser guestName="+e+" cb="+t),this.wb=!0;var i={type:"createGuestUserRequest",name:e};this.Hb=t,A(this,i)},n.prototype.waitInGuestRoom=function(e){h("Intf: waitInGuestRoom cb="+e);var t=this;t.yb=e,t.T.qa(function(e,i){null===e&&t.yb({type:"getUserMediaFailed",error:i})})},n.prototype.getContacts=function(e){h("Intf: getContacts cb="+e);var t={type:"contactsRequest",pattern:""};this.Jb=e,b(this,t)},n.prototype.getRecordings=function(e){h("Intf: getRecordings cb="+e);var t={type:"recordingsRequest",pattern:""};this.Kb=e,b(this,t)},n.prototype.getDevices=function(e){h("Intf: getDevices cb="+e),this.T.Va(e)},n.prototype.setMicrophone=function(e){h("Intf: setMicrophone id="+e),this.T.Wa(e)},n.prototype.setCamera=function(e){h("Intf: setCamera id="+e),this.T.Xa(e)},n.prototype.makeVoiceCall=function(e,t){h("Intf: makeVoiceCall id="+e+" cb="+t);var i={type:"voiceCallRequest",userId:e,name:this.xb};u(this,e),this.rb=i,this.yb=t,b(this,i)},n.prototype.joinVoiceConference=function(e,t){h("Intf: joinVoiceConference id="+e+" cb="+t);var i=this;i.yb=t,p(i,e),S(i,"joinVoiceConference"+e),t({type:"callProceeding"}),M(i,e,function(n){S(i,"gotTurnCreds"),i.T.va(n,i.Ib+1,function(n,a,o){if(null===n)return i.yb({type:"getUserMediaFailed",error:o}),void L(i,i.yb);S(i,"MainOffer"),t({type:"offerSdp"});var r={type:"voiceConfRequest",confId:e,userId:i.bb,userName:i.xb,bundleMode:a,sdp:n,maxDisplays:i.Ib,maxBitrateKbps:"0"};b(i,r)})})};var V=function(e){return e.T.Za(e.tb,1,function(t,i,n){if(null===t)return void e.yb({type:"getUserMediaFailed",error:n});var a={type:"offerSdpWithVideo",userId:l(e),sdp:t};e.yb&&e.yb(a),b(e,a)})},N=function(e){e.T.Za(e.tb,e.Ib+1,function(t,i){var n={type:"addVideoToConfRequest",confId:f(e),sdp:t,maxDisplays:e.Ib,maxBitrateKbps:e.tb.details.maxBitrateKbps};b(e,n)})};n.prototype.upgradeToVideo=function(){h("Intf: upgradeToVideo");var e=l(this);e.length>0?V(this):N(this)},n.prototype.makeVideoCall=function(e,t){h("Intf: makeVideoCall id="+e+" cb="+t);var i={type:"videoCallRequest",userId:e,name:this.xb};u(this,e),this.rb=i,this.yb=t,b(this,i)},n.prototype.joinGuestRoom=function(e,t,i){h("Intf: joinGuestRoom id="+e+" callType="+t+" cb="+i),this.wb=!0,"Voice"===t?this.makeVoiceCall(e,i):this.makeVideoCall(e,i)},n.prototype.joinVideoConference=function(e,t){h("Intf: joinVideoConference id="+e+" cb="+t);var i=this;i.yb=t,p(i,e),S(i,"joinVideoConference"+e),t({type:"callProceeding"}),M(i,e,function(n){S(i,"gotTurnCreds"),i.T.ta(n,s+1,function(a,o,r){if(null===a)return i.yb({type:"getUserMediaFailed",error:r}),void L(i,i.yb);S(i,"MainOffer"),t({type:"offerSdp"});var c={type:"videoConfRequest",confId:e,userId:i.bb,userName:i.xb,bundleMode:o,sdp:a,maxDisplays:s,maxBitrateKbps:n.details.maxBitrateKbps};b(i,c)})})},n.prototype.answerCall=function(e,t){h("Intf: answerCall callType="+e+" cb="+t),this.Fb.Gb();var i={type:"acceptCallResponse",userId:l(this),name:this.xb,callType:e};this.yb=t,this.yb(i),b(this,i)},n.prototype.rejectCall=function(){h("Intf: rejectCall"),this.Fb.Gb();var e={type:"rejectCallResponse",userId:l(this)};b(this,e),y(this)},n.prototype.ignoreCall=function(){h("Intf: ignoreCall"),this.Fb.Gb();var e={type:"ignoreCallResponse",userId:l(this)};b(this,e),y(this)},n.prototype.disconnectCall=function(e){h("Intf: disconnectCall cb="+e),S(this,"disconnectCall"),L(this,e)};var L=function(e,t){var i=function(){e.yb=t;var i={type:"disconnectCallRequest",userId:l(e)};i.userId.length<=0&&(i={type:"disconnectConfRequest",confId:f(e),userName:e.xb}),b(e,i),e.T.la(),y(e),t()},n=function(){e.lb?e.stopShare(function(){i()}):i()};e.mb&&e.stopRecording(),n()};n.prototype.muteVideo=function(){h("Intf: muteVideo"),S(this,"muteVideo"),this.T.Oa();var e={type:"userVideoMuted",userId:l(this)};e.userId.length<=0&&(e={type:"confVideoMuted",confId:f(this),userName:this.xb}),b(this,e)},n.prototype.muteMicrophone=function(){h("Intf: muteMicrophone"),S(this,"muteMic"),this.T.Pa();var e={type:"userAudioMuted",userId:l(this)};e.userId.length<=0&&(e={type:"confAudioMuted",confId:f(this),userName:this.xb}),b(this,e)},n.prototype.muteSpeaker=function(){h("Intf: muteSpeaker"),S(this,"muteSpeaker"),this.T.Qa()},n.prototype.unmuteVideo=function(){if(h("Intf: unmuteVideo"),S(this,"unmuteVideo"),this.pb)return!1;this.T.Ra();var e={type:"userVideoUnmuted",userId:l(this)};return e.userId.length<=0&&(e={type:"confVideoUnmuted",confId:f(this),userName:this.xb}),b(this,e),!0},n.prototype.unmuteMicrophone=function(){if(h("Intf: unmuteMicrophone"),S(this,"unmuteMic"),this.ob)return!1;this.T.Sa();var e={type:"userAudioUnmuted",userId:l(this)};return e.userId.length<=0&&(e={type:"confAudioUnmuted",confId:f(this),userName:this.xb}),b(this,e),!0},n.prototype.unmuteSpeaker=function(){h("Intf: unmuteSpeaker"),S(this,"unmuteSpeaker"),this.T.Ta()},n.prototype.addConference=function(e,t){h("Intf: addConference conf="+JSON.stringify(e)+" cb="+t),this.Nb=t,e.hasOwnProperty("name")||(e.name="NO NAME"),e.hasOwnProperty("autoRecord")||(e.autoRecord=!1),e.hasOwnProperty("maxBitrateKbps")||(e.maxBitrateKbps="auto"),e.hasOwnProperty("mode")||(e.mode="group");var i={type:"userAddConference",conference:e};b(this,i)},n.prototype.modifyConference=function(e,t){h("Intf: modifyConference conf="+JSON.stringify(e)+" cb="+t),this.Pb=t;var i={type:"userModifyConference",conference:e};b(this,i)},n.prototype.deleteConference=function(e,t){h("Intf: deleteConference conf="+JSON.stringify(e)+" cb="+t),this.Ob=t;var i={type:"userDeleteConference",conference:e};b(this,i)},n.prototype.acknowledgeRaisedHand=function(e,t){h("Intf: acknowledgeRaiseHand userId="+e+" audioUnmuted="+t),b(this,{type:"confAckRaiseHand",confId:f(this),userId:e,audioUnmuted:t})},n.prototype.sendApplicationData=function(e){h("Intf: sendApplicationData"),S(this,"AppData");var t={type:"userApplicationData",userId:l(this)};t.userId.length<=0&&(t={type:"confApplicationData",confId:f(this)}),t.applicationData=e,b(this,t)},n.prototype.getStatsFunction=function(){return h("Intf: getStatsFunction"),this.T.ab()},n.prototype.formatParticipants=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].split("||");t.push({name:n[0],id:parseInt(n[1],10),callType:n[2],audio:"audio-unmute"===n[4]?"unmuted":"muted",video:"video-unmute"===n[5]?"unmuted":"muted",state:n[6]})}return t},n.prototype.joinShareConference=function(e,t){h("Intf: joinShareConference id="+e+" cb="+t);var i=this;i.yb=t,p(i,e),S(i,"joinShareConference"+e),t({type:"callProceeding"}),M(i,e,function(n){S(i,"gotTurnCreds"),i.T.wa(n,s+1,function(n,a,o){if(null===n)return i.yb({type:"getUserMediaFailed",error:o}),void L(i,i.yb);S(i,"MainOffer"),t({type:"offerSdp"});var r={type:"shareConfRequest",confId:e,userId:i.bb,userName:i.xb,bundleMode:a,sdp:n,maxDisplays:i.Ib,maxBitrateKbps:0};b(i,r)})})},n.prototype.getCallManager=function(e){return h("Intf: getCallManager"),null===this.Lb&&(b(this,{type:"callMgrRequest"}),this.Lb=new CallManager(this,e),this.disableNotification()),this.Lb},e.WebRtcClient=n}(window);