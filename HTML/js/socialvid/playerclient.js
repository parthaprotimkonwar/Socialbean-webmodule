/**
 Copyright(c) 2016-17 SocialVid.in. All rights reserved.
 **/
!function(t){function i(t){var i={x:0,y:0};return t.hasOwnProperty("layerX")?(i.x=t.layerX,i.y=t.layerY):(i.x=t.offsetX,i.y=t.offsetY),i}function e(t,i,e){this.a=!1,this.b=t,this.c=i,this.d=e,this.e=[]}function s(t,i,e){this.a=!1,this.b=t,this.e=[],this.k=10}function a(t,i,e){this.a=!1,this.b=t,this.c=i,this.d=e,this.e=[]}function h(t,i,e){this.a=!1,this.b=t,this.c=i,this.d=e,this.e=[]}function o(t,i,e){this.a=!1,this.b=t,this.e=[]}function r(t){this.o=document.createElement("canvas"),this.p=this.o.getContext("2d"),this.q=t}e.prototype.f=function(t){this.a=!0,this.e.length=0,this.e.push(t)},e.prototype.g=function(t){this.a&&(this.c.clearRect(0,0,this.d.width,this.d.height),this.c.beginPath(),this.c.moveTo(this.e[0].x,this.e[0].y),this.c.lineTo(t.x,t.y),this.c.stroke())},e.prototype.h=function(t){return this.a?(this.g(t),this.a=!1,this.b.drawImage(this.d,0,0),this.c.clearRect(0,0,this.d.width,this.d.height),this.e.push(t),!0):!1},e.prototype.i=function(){return this.e},e.prototype.j=function(t){this.b.beginPath(),this.b.moveTo(t[0].x,t[0].y),this.b.lineTo(t[1].x,t[1].y),this.b.stroke()},s.prototype.l=function(){this.b.globalCompositeOperation="destination-out",this.b.fillStyle="rgba(0, 0, 0, 1.0)"},s.prototype.f=function(t){this.a=!0,this.e.length=0,this.e.push(t),this.b.save(),this.l()},s.prototype.g=function(t){this.a&&(this.b.fillRect(t.x-this.k,t.y-this.k,this.k,this.k),this.e.push(t))},s.prototype.h=function(t){return this.a?(this.g(t),this.a=!1,this.b.restore(),!0):!1},s.prototype.i=function(){return this.e},s.prototype.j=function(t){this.b.save(),this.l();for(var i=0;i<t.length;i++)this.b.fillRect(t[i].x-this.k,t[i].y-this.k,this.k,this.k);this.b.restore()},a.prototype.f=function(t){this.a=!0,this.e.length=0,this.e.push(t)},a.prototype.m=function(t,i,e){var s=Math.min(t.x,i.x),a=Math.min(t.y,i.y),h=Math.abs(t.x-i.x),o=Math.abs(t.y-i.y);e.strokeRect(s,a,h,o)},a.prototype.g=function(t){this.a&&(this.c.clearRect(0,0,this.d.width,this.d.height),this.m(this.e[0],t,this.c))},a.prototype.h=function(t){return this.a?(this.g(t),this.a=!1,this.b.drawImage(this.d,0,0),this.c.clearRect(0,0,this.d.width,this.d.height),this.e.push(t),!0):!1},a.prototype.i=function(){return this.e},a.prototype.j=function(t){this.m(t[0],t[1],this.b)},h.prototype.f=function(t){this.a=!0,this.e.length=0,this.e.push(t)},h.prototype.n=function(t,i,e){var s=t.x,a=t.y,h=Math.abs(s-i.x),o=Math.abs(a-i.y),r=Math.max(h,o);e.arc(s,a,r,0,2*Math.PI,!1),e.stroke()},h.prototype.g=function(t){this.a&&(this.c.clearRect(0,0,this.d.width,this.d.height),this.c.beginPath(),this.n(this.e[0],t,this.c))},h.prototype.h=function(t){return this.a?(this.g(t),this.a=!1,this.b.drawImage(this.d,0,0),this.c.clearRect(0,0,this.d.width,this.d.height),this.e.push(t),!0):!1},h.prototype.i=function(){return this.e},h.prototype.j=function(t){this.b.beginPath(),this.n(t[0],t[1],this.b)},o.prototype.f=function(t){this.b.beginPath(),this.b.moveTo(t.x,t.y),this.a=!0,this.e.length=0,this.e.push(t)},o.prototype.g=function(t){this.a&&(this.b.lineTo(t.x,t.y),this.b.stroke(),this.e.push(t))},o.prototype.h=function(t){return this.a?(this.g(t),this.a=!1,this.e.length>2?!0:!1):!1},o.prototype.i=function(){return this.e},o.prototype.j=function(t){this.b.beginPath(),this.b.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++)this.b.lineTo(t[i].x,t[i].y);this.b.stroke()},r.prototype.r=function(){this.s&&this.t&&(this.s.clearRect(0,0,this.u.width,this.u.height),this.t.clearRect(0,0,this.v.width,this.v.height))},r.prototype.f=function(t){var e=i(t);this.w.f(e)},r.prototype.g=function(t){var e=i(t);this.w.g(e)},r.prototype.h=function(t){var e=i(t);if(this.w.h(e)){var s=this.w.i();if(s.length>0){var a={shape:this.z,color:this.A,linewidth:this.B,coords:s,width:this.u.width,height:this.u.height};this.q(a)}}},r.prototype.C=function(t,i){var r=this;this.u=t,this.v=i,this.s=this.u.getContext("2d"),this.t=this.v.getContext("2d"),this.D=new o(this.s,this.t,this.v),this.F=new e(this.s,this.t,this.v),this.G=new a(this.s,this.t,this.v),this.H=new h(this.s,this.t,this.v),this.I=new s(this.s,this.t,this.v),i.addEventListener("mousedown",r.f.bind(r),!1),i.addEventListener("mousemove",r.g.bind(r),!1),i.addEventListener("mouseup",r.h.bind(r),!1),i.addEventListener("mouseleave",r.h.bind(r),!1)},r.prototype.J=function(t,i){this.o.width=t,this.o.height=i,this.p.drawImage(this.u,0,0,t,i),this.u.width=t,this.u.height=i,this.s.drawImage(this.o,0,0),this.v.width=t,this.v.height=i,this.K(this.z,this.A,this.B)},r.prototype.j=function(t){if("image"===t.shape)return void this.L(t.coords,!1);this.s.save();var i=this.u.width/t.width,e=this.u.height/t.height;switch(this.s.strokeStyle=t.color,this.s.fillStyle=t.color,this.s.lineWidth=t.linewidth,this.s.scale(i,e),t.shape){case"pencil":this.D.j(t.coords);break;case"line":this.F.j(t.coords);break;case"rectangle":this.G.j(t.coords);break;case"circle":this.H.j(t.coords);break;case"eraser":this.I.j(t.coords);break;case"text":var s=.02*t.width+4*parseInt(t.linewidth,10);this.s.font=s+"px sans-serif",this.s.fillText(t.coords.text,t.coords.x,t.coords.y)}this.s.restore()},r.prototype.K=function(t,i,e){switch(t){case"pencil":this.w=this.D;break;case"line":this.w=this.F;break;case"rectangle":this.w=this.G;break;case"circle":this.w=this.H;break;case"eraser":this.w=this.I;break;default:return}this.z=t,this.A=i,this.B=e,this.s&&this.t&&(this.s.strokeStyle=i,this.s.lineWidth=e,this.t.strokeStyle=i,this.t.lineWidth=e)},r.prototype.M=function(t){var i=t.width,e=t.height,s=i/e,a=this.u.width,h=this.u.height,o=a/h,r=0,n=0;o>s?(e=h,i=Math.floor(s*h),r=Math.floor((a-i)/2)):(i=a,e=Math.floor(a/s),n=Math.floor((h-e)/2)),this.s.drawImage(t,r,n,i,e)},r.prototype.L=function(t,i){var e=this,s=new Image;s.onload=function(){e.M(s);var a={shape:"image",coords:t};i&&e.q(a)},s.src=t},r.prototype.N=function(t){var i=this,e=new FileReader;e.onload=function(){i.L(e.result,!0)},e.readAsDataURL(t)},r.prototype.O=function(t,i,e,s,a){this.s.font=.02*this.u.width+4*parseInt(a,10)+"px sans-serif",this.s.fillStyle=s,this.s.fillText(t,i,e);var h={shape:"text",color:s,linewidth:a,coords:{text:t,x:i,y:e},width:this.u.width,height:this.u.height};this.q(h)},t.Whiteboard=r}(window),function(t){function i(){this.P=[],this.Q=0,this.R=new Whiteboard(function(){}),this.v=document.createElement("canvas")}function e(t,i,e,s,a){this.W=i+e.filePath,this.X=e.name?e.name:"media"+t,this.Y=s,this.Z=e.type,this.q=a,this.$=t,this.S=e.startTime,this._=0}function s(t,e,s){var a=this;a.q=s,a.ka=e,a.la={},a.ma="INIT",a.na=1,a.oa=[],a.pa=[],a.qa={},a.ra=[];for(var h=0;n>h;h++)a.ra.push(-1);var o=new XMLHttpRequest,r=t,d="";if(0===t.indexOf("http")){var p=new URL(t);d=p.protocol+"//"+p.host}var u=function(){a.sa.addEventListener("canplaythrough",a.ta.bind(a)),a.sa.addEventListener("ended",a.ua.bind(a)),a.sa.addEventListener("timeupdate",a.va.bind(a)),a.sa.setAttribute("type","audio/"+a.wa.audio[0].type),a.xa={},a.ya={},a.za={},a.Aa=document.getElementsByTagName("canvas")[0],a.Ba.T(a.Aa),a.ma="INIT",a.la.audio=1,a.Ca(),a.sa.src=d+a.wa.audio[0].filePath,a.Da(d),a.ha(a.sa.currentTime),a.q({type:"status",status:0}),a.q({type:"loadAudio",id:0,audio:a.sa,name:"MainAudio"})};o.open("get",r),o.onload=function(){a.aa(""+r+" response received with status "+o.status+" : "+o.statusText),a.aa("VideoJSON: "+o.responseText);try{a.wa=JSON.parse(o.responseText)}catch(t){return console.log("JSON PARSE FAILED",t),void a.q({type:"status",status:-1,err:t})}return a.Ea()?(a.Ba=new i,void a.Ba.S(d,a.wa.annotation,function(t,i){t?u():a.q({type:"status",status:-1,err:i})})):void a.q({type:"status",status:-1,err:"CONTAINER_NOT_EMPTY"})},o.onerror=function(t){a.aa(""+r+" error response",t),a.q({type:"status",status:-1,err:t})},o.send()}var a=16,h=9,o=function(t,i,e){if(0>=t)return[];var s,o;if(i)switch(t){case 1:s=o=1;break;case 2:s=1,o=2;break;case 3:case 4:s=o=2;break;case 5:case 6:s=2,o=3;break;case 7:case 8:case 9:s=3,o=3}else switch(t){case 1:o=s=1;break;default:o=t,s=t-1}var r,n,d=a*o/(h*s),p=e.clientWidth,u=e.clientHeight,c=p/u,l=0,f=0;c>d?(n=u,r=p*d/c,l=Math.floor((p-r)/2)):(r=p,n=u*c/d,f=Math.floor((u-n)/2));var y=Math.floor(r/o),v=Math.floor(n/s),g=[];if(i){for(var m=0,b=0;s>b;b++)for(var E=0;o>E;E++){var w={};if(w.top=v*b+f,w.left=y*E+l,w.width=y,w.height=v,g.push(w),m++,m==t)break}3==t?g[2].left+=y/2:5==t&&(g[3].left+=y/2,g[4].left+=y/2)}else{var w={};w.top=f,w.left=l,w.height=v*s,w.width=o>1?y*(o-1):y,g.push(w);for(var L=1;t>L;L++){var w={};w.top=(L-1)*v+f,w.left=y*(o-1)+l,w.height=v,w.width=y,g.push(w)}}return g},r=function(t,i){t.style.top=i.top+"px",t.style.height=i.height+"px",t.style.left=i.left+"px",t.style.width=i.width+"px"},n=4;i.prototype.r=function(){this.R.r()},i.prototype.S=function(t,i,e){var s=this;if(!i||!i.filePath)return void e(!0,null);var a=new XMLHttpRequest;a.open("get",t+i.filePath),a.onload=function(){console.log(""+t+" "+i.filePath+" response received with status "+a.status+" : "+a.statusText),console.log("AnnotationJSON: "+a.responseText);try{s.P=JSON.parse(a.responseText).annotations}catch(t){return console.log("JSON PARSE FAILED",t),void e(!1,t)}e(!0,null)},a.onerror=function(t){console.log(""+i.filePath+" error response",t),e(!1,t)},a.send()},i.prototype.T=function(t){this.R.C(t,this.v)},i.prototype.U=function(t){var i=this.Q;for(i=this.Q;i<this.P.length;i++){var e=this.P[i];if(console.log(" i = "+i+" t = "+t+" startTime = "+e.startTime),!(t>e.startTime))break;console.log("ANNOTATING"),this.V(JSON.parse(e.annotationData))}this.Q=i},i.prototype.V=function(t){this.R.j(t.draw)},e.AUDIO="audio",e.VIDEO="video",e.prototype.aa=function(t){console.log((new Date).toISOString()+" - "+this.Y+" ["+this.X+"]: ",t)},e.prototype.ba=function(){var t=this,i=t.ca.bind(t);this.da.addEventListener("canplaythrough",i),this.da.addEventListener("ended",i),this.da.addEventListener("loadeddata",i),this.da.addEventListener("loadedmetadata",i),this.da.addEventListener("pause",i),this.da.addEventListener("play",i),this.da.addEventListener("playing",i),this.da.addEventListener("progress",i),this.da.addEventListener("stalled",i)},e.prototype.ea=function(){var t=this,i=t.ca.bind(t);this.da.removeEventListener("canplaythrough",i),this.da.removeEventListener("ended",i),this.da.removeEventListener("loadeddata",i),this.da.removeEventListener("loadedmetadata",i),this.da.removeEventListener("pause",i),this.da.removeEventListener("play",i),this.da.removeEventListener("playing",i),this.da.removeEventListener("progress",i),this.da.removeEventListener("stalled",i)},e.prototype.fa=function(){1===this._&&(this._=2,this.q({type:"start",id:this.$}))},e.prototype.ca=function(t){switch(t.type){case"progress":this.da.buffered.length>0&&(this.aa("Progress: ["+this.da.buffered.end(0)+"/"+this.da.duration+"] = "+100*this.da.buffered.end(0)/this.da.duration),this.q({type:"progress",id:this.$}));break;case"canplaythrough":this._=1,-1===this.S&&this.fa();break;case"ended":this.ea(),this.da.src="",this.q({type:"ended",id:this.$});break;default:this.aa("Evt: "+t.type)}},e.prototype.ga=function(){this.da||(this.aa("Loading "+this.Y+' with "'+this.X+'" and path: '+this.W),this.da=document.createElement(this.Y),this.da.setAttribute("type",this.Y+"/"+this.Z),this.da.setAttribute("preload","auto"),this.Y===e.VIDEO&&this.da.setAttribute("muted",!0),this.ba(),this.da.src=this.W)},e.prototype.ha=function(t){t>this.S-d&&this.ga(),t>=this.S&&(1===this._?this.fa():0===this._&&(this.q({type:"forcePause",id:this.$}),this.S=-1))},e.prototype.ia=function(){return this.da},e.prototype.ja=function(){return this.X};var d=18e4,p=250;s.prototype.aa=function(t){console.log((new Date).toISOString()+" - Player: ",t)},s.prototype.Ea=function(){if(this.ka.children.length>0)return this.aa(" ERROR: Container NOT EMPTY"),!1;this.sa=document.createElement("audio"),this.Fa=[];var t=document.createElement("div");t.className="videos-container",t.appendChild(this.sa);for(var i=0;n>=i;i++){if(this.Fa[i]=document.createElement("div"),this.Fa[i].className="video-div",0===i){var e=document.createElement("canvas");this.Fa[i].appendChild(e)}var s=document.createElement("div");s.className="video-label",this.Fa[i].appendChild(s),t.appendChild(this.Fa[i])}return this.ka.appendChild(t),!0},s.prototype.Ga=function(){var t=Object.keys(this.la).length;if(this.aa("CheckAndPlay - State: "+this.ma+" ForcePaused: "+t),!(t>0))switch(this.ma){case"INIT_FORCEPAUSED":this.ma="READY_TO_PLAY",this.q({type:"state",state:"READY_TO_PLAY"});break;case"PLAYING_FORCEPAUSED":case"PLAYING":this.ma="PLAYING",this.play()}},s.prototype.ta=function(t){this.aa("Audio can play through for "+t.target.id+" State - "+t.target.readyState),delete this.la.audio,this.Ga()},s.prototype.ua=function(t){this.aa("Audio Ended for "+t.target.id),this.pause(),this.ma="ENDED",this.q({type:"state",state:"ENDED"})},s.prototype.updateProgress=function(){if(!(this.sa.buffered.length<=0)){var t,i=this.sa.duration,e=this.sa.buffered.end(0);for(var s in this.qa)t=this.qa[s],i+=t.duration,e+=t.buffered.end(0);for(var a=0;n>a;a++)-1!==this.ra[a]&&(t=this.ya[this.ra[a]].ia(),i+=t.duration,e+=t.buffered.end(0));this.Ha&&(t=this.za[this.Ha].ia(),i+=t.duration,e+=t.buffered.end(0));var h=100*e/i;this.aa("Total Progress: ["+e+"/"+i+"] = "+h),this.q({type:"buffered",buffered:h})}},s.prototype.Da=function(t){for(var i=1,s=this.Ia.bind(this),a=1;a<this.wa.audio.length;a++)this.xa[i]=new e(i,t,this.wa.audio[a],e.AUDIO,s),i++;for(var h=this.Ja.bind(this),o=0;o<this.wa.video.length;o++)this.ya[i]=new e(i,t,this.wa.video[o],e.VIDEO,h),i++;for(var r=this.Ka.bind(this),n=0;n<this.wa.share.length;n++)this.za[i]=new e(i,t,this.wa.share[n],e.VIDEO,r),i++},s.prototype.ha=function(t){var i=1e3*t;i>p&&(i-=p);for(var e in this.xa)this.xa[e].ha(i);for(var s in this.ya)this.ya[s].ha(i);for(var a in this.za)this.za[a].ha(i);this.Ba.U(i)},s.prototype.va=function(t){this.aa("Audio current time: "+this.sa.currentTime),this.ha(this.sa.currentTime),this.q({type:"progress",progress:this.sa.currentTime,total:this.sa.duration})},s.prototype.La=function(t,i){this.oa=t,this.pa=i;var e=this.oa.reduce(function(t,i,e){return t+", "+i},""),s=this.pa.reduce(function(t,i,e){return t+", "+i},"");this.aa("VideoLayout: ["+e+"] Names: ["+s+"]");var a=t.length;this.Ha&&(a+=1);var h=o(a,!this.Ha,this.ka),d=this.Fa[0];this.Ha?(d.getElementsByClassName("video-label")[0].innerHTML=this.za[this.Ha].ja(),r(d,h[0]),h[0].top=0,h[0].left=0,r(this.Aa,h[0]),d.style.display="block",h=h.slice(1)):d.style.display="none";var p,u=[1,0,0,0,0,0,0];for(p=0;p<h.length&&n>p;p++){var c=t[p]+1,l=this.Fa[c];r(l,h[p]),l.style.display="block",u[c]=1,l.getElementsByClassName("video-label")[0].innerHTML=i[p]}for(p=1;n>=p;p++)0===u[p]&&(l=this.Fa[p],l.style.display="none",l.getElementsByClassName("video-label")[0].innerHTML="")},s.prototype.redraw=function(){this.La(this.oa,this.pa)},s.prototype.Ca=function(){switch(this.aa("ForcePause - State: "+this.ma),this.ma){case"INIT":this.ma="INIT_FORCEPAUSED",this.q({type:"state",state:"LOADING"});break;case"PLAYING":this.ma="PLAYING_FORCEPAUSED",this.q({type:"state",state:"LOADING"}),this.pause()}},s.prototype.Ia=function(t){switch(this.aa("AudioEvent: "+JSON.stringify(t)),t.type){case"start":delete this.la[t.id],this.Ma(t.id),this.Ga();break;case"ended":this.Na(t.id);break;case"forcePause":this.la[t.id]=1,this.Ma(t.id),this.Ca();break;case"progress":this.updateProgress();break;default:this.aa("UNHANDLED AUDIO EVENT "+t.type)}},s.prototype.Ja=function(t){switch(this.aa("VideoEvent: "+JSON.stringify(t)),t.type){case"start":delete this.la[t.id],this.Oa(t.id),this.Ga();break;case"ended":this.Pa(t.id);break;case"forcePause":this.la[t.id]=1,this.Oa(t.id),this.Ca();break;case"progress":this.updateProgress();break;default:this.aa("UNHANDLED VIDEO EVENT "+t.type)}},s.prototype.Ka=function(t){switch(this.aa("ShareVideoEvent: "+JSON.stringify(t)),t.type){case"start":delete this.la[t.id],this.Qa(t.id),this.Ga();break;case"ended":this.Ra(t.id);break;case"forcePause":this.la[t.id]=1,this.Qa(t.id),this.Ca();break;case"progress":this.updateProgress();break;default:this.aa("UNHANDLED SHARE VIDEO EVENT "+t.type)}},s.prototype.Ma=function(t){if(this.qa.hasOwnProperty(t))return void this.aa("loadAudio "+t+" ALREADY LOADED");var i=this.xa[t].ia();this.qa[t]=i,this.ka.children[0].appendChild(i),this.q({type:"loadAudio",id:t,audio:i,name:this.xa[t].ja()})},s.prototype.Oa=function(t){var i=this.ra.indexOf(t);if(-1!==i)return void this.aa("LoadVideoInDom: "+t+" already loaded at "+i);var e=this.ra.indexOf(-1);if(-1===e)return void this.aa("LoadVideoInDom: NO FREE SLOT");this.ra[e]=t;var s=this.Fa[e+1],a=this.ya[t].ia(),h=s.firstChild;s.insertBefore(a,h),this.Sa(),this.q({type:"loadVideo",id:t,video:a,name:this.ya[t].ja()})},s.prototype.Qa=function(t){var i=this.Ha;if(i)return void this.aa("LoadShareVideoInDom: SHARE ALREADY LOADED WITH "+i);this.Ha=t;var e=this.Fa[0],s=this.za[t].ia(),a=e.firstChild;e.insertBefore(s,a),this.Sa(),this.q({type:"loadShare",id:t,video:s,name:this.za[t].ja()})},s.prototype.Sa=function(){for(var t=[],i=[],e=0;e<this.ra.length;e++)-1!==this.ra[e]&&(t.push(e),i.push(this.ya[this.ra[e]].ja()));this.La(t,i)},s.prototype.Na=function(t){if(!this.qa.hasOwnProperty(t))return void this.aa("unloadAudio "+t+" NOT LOADED");var i=this.qa[t];this.ka.children[0].removeChild(i),delete this.qa[t],this.q({type:"unloadAudio",id:t,name:this.xa[t].ja()})},s.prototype.Pa=function(t){var i=this.ra.indexOf(t);if(-1===i)return void this.aa("Video "+t+" not found in dom");this.ra[i]=-1;var e=this.ya[t].ia();this.Fa[i+1].removeChild(e),this.Sa(),this.q({type:"unloadVideo",id:t,name:this.ya[t].ja()})},s.prototype.Ra=function(t){if(this.Ha){var i=this.za[this.Ha];this.Fa[0].removeChild(i.ia()),this.Ba.r()}this.Ha=!1,this.Sa(),this.q({type:"unloadShare",id:t,name:this.za[t].ja()})},s.prototype.Ta=function(){for(var t=document.getElementsByTagName("audio"),i=0;i<t.length;i++)t[i].playbackRate=this.na;for(var e=document.getElementsByTagName("video"),s=0;s<e.length;s++)e[s].playbackRate=this.na},s.prototype.play=function(){this.Ta();for(var t=document.getElementsByTagName("audio"),i=0;i<t.length;i++)t[i].play();for(var e=document.getElementsByTagName("video"),s=0;s<e.length;s++)e[s].play();this.ma="PLAYING",this.q({type:"state",state:"PLAYING"})},s.prototype.pause=function(){for(var t=document.getElementsByTagName("audio"),i=0;i<t.length;i++)t[i].pause();for(var e=document.getElementsByTagName("video"),s=0;s<e.length;s++)e[s].pause();this.ma="PAUSED",this.q({type:"state",state:"PAUSED"})},s.prototype.setRate=function(t){return.5>t||t>4?!1:(this.na=t,this.Ta(),!0)},s.prototype.getRate=function(){return this.na},t.WebRtcPlayer=s}(window);